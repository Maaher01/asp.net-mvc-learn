@model IEnumerable<Day_10_Work_01.ViewModels.WorkerViewModel>
@{
    ViewBag.Title = "Index";
}

<div class="col-12">
    <div class="col-12">
        <h3>All Workers</h3>
        <div id="spinner" style="display: none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <div class="d-flex justify-content-end mb-3">
            <a class="btn btn-primary" href="@Url.Action("Create", "Workers")"><i class="bi bi-plus"></i> Create new</a>
        </div>
        <div id="tableDiv">
            @Html.Action("GetWorkersTable")
        </div>
    </div>
</div>
<div class="modal" tabindex="-1" id="delModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this entry?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" id="confirm" >Delete</button>
            </div>
        </div>
    </div>
</div>

@section styles {
    <link href="~/Content/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
}

@section scripts {
    <script src="~/Scripts/jquery-3.7.1.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
    <script>
        var myModal = new bootstrap.Modal(document.getElementById('delModal'), { keyboard: false });
        var idToDelete = -1;

        $(document).on('click', 'button.del', function () {
            let id = $(this).data("pk");
            idToDelete = id;
            myModal.show()
        })

        $('#confirm').click(() => {
            $.ajax({
                type: "post",
                url: `/Workers/Delete/${idToDelete}`,
                dataType: "json",
                success: r => {
                    if (r.success == true) {
                        $(`#worker_${idToDelete}`).remove();
                        idToDelete = -1;
                        myModal.hide();
                    }
                }
            })
        })
    </script>
}